#lang racket

(require racket/draw)

(define W 2048)
(define H 2048)

(define src (read-bitmap "assets/FREECG98.BMP"))
(define out (make-bitmap W H))
(define buf (make-bytes (* 16 16 4)))

(define (blit w h X Y)  
  (for* ([x X]
         [y Y])
    (send src get-argb-pixels x y w h buf)
    (send out set-argb-pixels x y w h buf)))

;; copy half-width glyphs in the first line
(let ([w  8]
      [h 16])
  (blit w
        h
        (range 0 W w)
        (range 0 h h)))

;; copy full-width glyphs in the remaining lines
(let ([w 16]
      [h 16])
  (blit w
        h
        (range 0 W w)
        (range h H h)))

;; copy extra!

(define (copy k0 t0 k1 t1)
  (define w 16)
  (define h 16)
  (define (x k) (* k w))
  (define (y t) (* (+ t 32) h))
  (send src get-argb-pixels (x k0) (y t0) w h buf)
  (send out set-argb-pixels (x k1) (y t1) w h buf))

(define (nk k t i) (+ k (quotient (+ (sub1 t) i) 94)))
(define (nt t i)   (add1 (remainder (+ (sub1 t) i) 94)))

(define (copy* k0 t0 k1 t1 n)
  (for ([i (range n)])
    (copy (nk k0 t0 i)
          (nt t0 i)
          (nk k1 t1 i)
          (nt t1 i))))

;(copy 9 1 85 1)
;(copy* 9 1 85 1 94)

;; patch!
(define ref (read-bitmap "assets/unifont-13.0.06.bmp"))

(define (patch c k t)
  (displayln (format "~a ~a ~a" c k t))
  (define u (char->integer c))
  (define u1 (arithmetic-shift (bitwise-and u #xFF00) -8))
  (define u2 (bitwise-and u #x00FF))
  (define i k)
  (define j (+ t 32))
  (patch* u1 u2 i j))

(define (patch* u1 u2 i j)
  (define w 16)
  (define h 16)
  (let ([x (* (+ u2 2) w)]
        [y (* (+ u1 4) h)])
    (send ref get-argb-pixels x y w h buf))
  (let ([x (* i w)]
        [y (* j h)])
    (send out set-argb-pixels x y w h buf)))

(define (patch/list l k t)
  (define n (length l))
  (for ([c l]
        [i (range n)])
    (patch c
           (+ k (quotient (+ (sub1 t) i) 94))
           (add1 (remainder (+ (sub1 t) i) 94)))))

;(patch* #x00 #xc0 9 55)
;(patch #\u00c0 9 22)

(define ascii
 '(#\! #\" #\# #\$ #\% #\& #\' #\( #\) #\* #\+ #\, #\- #\. #\/
   #\0 #\1 #\2 #\3 #\4 #\5 #\6 #\7 #\8 #\9
   #\: #\; #\< #\= #\> #\? #\@
   #\A #\B #\C #\D #\E #\F #\G #\H #\I #\J #\K #\L #\M #\N #\O #\P #\Q #\R #\S #\T #\U #\V #\W #\X #\Y #\Z
   #\[ #\\ #\] #\^ #\_ #\`
   #\a #\b #\c #\d #\e #\f #\g #\h #\i #\j #\k #\l #\m #\n #\o #\p #\q #\r #\s #\t #\u #\v #\w #\x #\y #\z
   #\{ #\| #\} #\~))

(patch/list ascii 48 1)
(patch/list '(#\ ) 49 1) ; missing space

;(include "patch-table.rkt")
;(include "patch-table-full.rkt")

(define diac
 '(#\u01CD ; 84ED  ; Ǎ	# LATIN CAPITAL LETTER A WITH CARON	[2000]	
   #\u01CE ; 84EE  ; ǎ	# LATIN SMALL LETTER A WITH CARON	[2000]	
   #\u01D0 ; 84EF  ; ǐ	# LATIN SMALL LETTER I WITH CARON	[2000]	
   #\u1E3E ; 84F0  ; Ḿ	# LATIN CAPITAL LETTER M WITH ACUTE	[2000]	
   #\u1E3F ; 84F1  ; ḿ	# LATIN SMALL LETTER M WITH ACUTE	[2000]	
   #\u01F8 ; 84F2  ; Ǹ	# LATIN CAPITAL LETTER N WITH GRAVE	[2000]	
   #\u01F9 ; 84F3  ; ǹ	# LATIN SMALL LETTER N WITH GRAVE	[2000]	
   #\u01D1 ; 84F4  ; Ǒ	# LATIN CAPITAL LETTER O WITH CARON	[2000]	
   #\u01D2 ; 84F5  ; ǒ	# LATIN SMALL LETTER O WITH CARON	[2000]	
   #\u01D4 ; 84F6  ; ǔ	# LATIN SMALL LETTER U WITH CARON	[2000]
   #\u01D6 ; 84F7  ; ǖ	# LATIN SMALL LETTER U WITH DIAERESIS AND MACRON	[2000]
   #\u01D8 ; 84F8  ; ǘ	# LATIN SMALL LETTER U WITH DIAERESIS AND ACUTE	[2000]
   #\u01DA ; 84F9  ; ǚ	# LATIN SMALL LETTER U WITH DIAERESIS AND CARON	[2000]
   #\u01DC ; 84FA  ; ǜ	# LATIN SMALL LETTER U WITH DIAERESIS AND GRAVE	[2000]
   #\u00BF ; 8555  ; ¿	# INVERTED QUESTION MARK	[2000]
   #\u00C0 ; 8556  ; À	# LATIN CAPITAL LETTER A WITH GRAVE	[2000]
   #\u00C1 ; 8557  ; Á	# LATIN CAPITAL LETTER A WITH ACUTE	[2000]
   #\u00C2 ; 8558  ; Â	# LATIN CAPITAL LETTER A WITH CIRCUMFLEX	[2000]
   #\u00C3 ; 8559  ; Ã	# LATIN CAPITAL LETTER A WITH TILDE	[2000]
   #\u00C4 ; 855A  ; Ä	# LATIN CAPITAL LETTER A WITH DIAERESIS	[2000]
   #\u00C5 ; 855B  ; Å	# LATIN CAPITAL LETTER A WITH RING ABOVE	[2000]
   #\u00C6 ; 855C  ; Æ	# LATIN CAPITAL LETTER AE 	[2000]
   #\u00C7 ; 855D  ; Ç	# LATIN CAPITAL LETTER C WITH CEDILLA	[2000]
   #\u00C8 ; 855E  ; È	# LATIN CAPITAL LETTER E WITH GRAVE	[2000]
   #\u00C9 ; 855F  ; É	# LATIN CAPITAL LETTER E WITH ACUTE	[2000]
   #\u00CA ; 8560  ; Ê	# LATIN CAPITAL LETTER E WITH CIRCUMFLEX	[2000]
   #\u00CB ; 8561  ; Ë	# LATIN CAPITAL LETTER E WITH DIAERESIS	[2000]
   #\u00CC ; 8562  ; Ì	# LATIN CAPITAL LETTER I WITH GRAVE	[2000]
   #\u00CD ; 8563  ; Í	# LATIN CAPITAL LETTER I WITH ACUTE	[2000]
   #\u00CE ; 8564  ; Î	# LATIN CAPITAL LETTER I WITH CIRCUMFLEX	[2000]
   #\u00CF ; 8565  ; Ï	# LATIN CAPITAL LETTER I WITH DIAERESIS	[2000]
   #\u00D0 ; 8566  ; Ð	# LATIN CAPITAL LETTER ETH 	[2000]
   #\u00D1 ; 8567  ; Ñ	# LATIN CAPITAL LETTER N WITH TILDE	[2000]
   #\u00D2 ; 8568  ; Ò	# LATIN CAPITAL LETTER O WITH GRAVE	[2000]
   #\u00D3 ; 8569  ; Ó	# LATIN CAPITAL LETTER O WITH ACUTE	[2000]
   #\u00D4 ; 856A  ; Ô	# LATIN CAPITAL LETTER O WITH CIRCUMFLEX	[2000]
   #\u00D5 ; 856B  ; Õ	# LATIN CAPITAL LETTER O WITH TILDE	[2000]
   #\u00D6 ; 856C  ; Ö	# LATIN CAPITAL LETTER O WITH DIAERESIS	[2000]
   #\u00D8 ; 856D  ; Ø	# LATIN CAPITAL LETTER O WITH STROKE	[2000]
   #\u00D9 ; 856E  ; Ù	# LATIN CAPITAL LETTER U WITH GRAVE	[2000]
   #\u00DA ; 856F  ; Ú	# LATIN CAPITAL LETTER U WITH ACUTE	[2000]
   #\u00DB ; 8570  ; Û	# LATIN CAPITAL LETTER U WITH CIRCUMFLEX	[2000]
   #\u00DC ; 8571  ; Ü	# LATIN CAPITAL LETTER U WITH DIAERESIS	[2000]
   #\u00DD ; 8572  ; Ý	# LATIN CAPITAL LETTER Y WITH ACUTE	[2000]
   #\u00DE ; 8573  ; Þ	# LATIN CAPITAL LETTER THORN 	[2000]
   #\u00DF ; 8574  ; ß	# LATIN SMALL LETTER SHARP S 	[2000]
   #\u00E0 ; 8575  ; à	# LATIN SMALL LETTER A WITH GRAVE	[2000]
   #\u00E1 ; 8576  ; á	# LATIN SMALL LETTER A WITH ACUTE	[2000]
   #\u00E2 ; 8577  ; â	# LATIN SMALL LETTER A WITH CIRCUMFLEX	[2000]
   #\u00E3 ; 8578  ; ã	# LATIN SMALL LETTER A WITH TILDE	[2000]
   #\u00E4 ; 8579  ; ä	# LATIN SMALL LETTER A WITH DIAERESIS	[2000]
   #\u00E5 ; 857A  ; å	# LATIN SMALL LETTER A WITH RING ABOVE	[2000]
   #\u00E6 ; 857B  ; æ	# LATIN SMALL LETTER AE 	[2000]
   #\u00E7 ; 857C  ; ç	# LATIN SMALL LETTER C WITH CEDILLA	[2000]
   #\u00E8 ; 857D  ; è	# LATIN SMALL LETTER E WITH GRAVE	[2000]
   #\u00E9 ; 857E  ; é	# LATIN SMALL LETTER E WITH ACUTE	[2000]
   #\u00EA ; 8580  ; ê	# LATIN SMALL LETTER E WITH CIRCUMFLEX	[2000]
   #\u00EB ; 8581  ; ë	# LATIN SMALL LETTER E WITH DIAERESIS	[2000]
   #\u00EC ; 8582  ; ì	# LATIN SMALL LETTER I WITH GRAVE	[2000]
   #\u00ED ; 8583  ; í	# LATIN SMALL LETTER I WITH ACUTE	[2000]
   #\u00EE ; 8584  ; î	# LATIN SMALL LETTER I WITH CIRCUMFLEX	[2000]
   #\u00EF ; 8585  ; ï	# LATIN SMALL LETTER I WITH DIAERESIS	[2000]
   #\u00F0 ; 8586  ; ð	# LATIN SMALL LETTER ETH 	[2000]
   #\u00F1 ; 8587  ; ñ	# LATIN SMALL LETTER N WITH TILDE	[2000]
   #\u00F2 ; 8588  ; ò	# LATIN SMALL LETTER O WITH GRAVE	[2000]
   #\u00F3 ; 8589  ; ó	# LATIN SMALL LETTER O WITH ACUTE	[2000]
   #\u00F4 ; 858A  ; ô	# LATIN SMALL LETTER O WITH CIRCUMFLEX	[2000]
   #\u00F5 ; 858B  ; õ	# LATIN SMALL LETTER O WITH TILDE	[2000]
   #\u00F6 ; 858C  ; ö	# LATIN SMALL LETTER O WITH DIAERESIS	[2000]
   #\u00F8 ; 858D  ; ø	# LATIN SMALL LETTER O WITH STROKE	[2000]
   #\u00F9 ; 858E  ; ù	# LATIN SMALL LETTER U WITH GRAVE	[2000]
   #\u00FA ; 858F  ; ú	# LATIN SMALL LETTER U WITH ACUTE	[2000]
   #\u00FB ; 8590  ; û	# LATIN SMALL LETTER U WITH CIRCUMFLEX	[2000]
   #\u00FC ; 8591  ; ü	# LATIN SMALL LETTER U WITH DIAERESIS	[2000]
   #\u00FD ; 8592  ; ý	# LATIN SMALL LETTER Y WITH ACUTE	[2000]
   #\u00FE ; 8593  ; þ	# LATIN SMALL LETTER THORN 	[2000]
   #\u00FF ; 8594  ; ÿ	# LATIN SMALL LETTER Y WITH DIAERESIS	[2000]
   #\u0100 ; 8595  ; Ā	# LATIN CAPITAL LETTER A WITH MACRON	[2000]
   #\u012A ; 8596  ; Ī	# LATIN CAPITAL LETTER I WITH MACRON	[2000]
   #\u016A ; 8597  ; Ū	# LATIN CAPITAL LETTER U WITH MACRON	[2000]
   #\u0112 ; 8598  ; Ē	# LATIN CAPITAL LETTER E WITH MACRON	[2000]
   #\u014C ; 8599  ; Ō	# LATIN CAPITAL LETTER O WITH MACRON	[2000]
   #\u0101 ; 859A  ; ā	# LATIN SMALL LETTER A WITH MACRON	[2000]
   #\u012B ; 859B  ; ī	# LATIN SMALL LETTER I WITH MACRON	[2000]
   #\u016B ; 859C  ; ū	# LATIN SMALL LETTER U WITH MACRON	[2000]
   #\u0113 ; 859D  ; ē	# LATIN SMALL LETTER E WITH MACRON	[2000]
   #\u014D ; 859E  ; ō	# LATIN SMALL LETTER O WITH MACRON	[2000]
   #\u0104 ; 859F  ; Ą	# LATIN CAPITAL LETTER A WITH OGONEK	[2000]
   #\u0141 ; 85A1  ; Ł	# LATIN CAPITAL LETTER L WITH STROKE	[2000]
   #\u013D ; 85A2  ; Ľ	# LATIN CAPITAL LETTER L WITH CARON	[2000]
   #\u015A ; 85A3  ; Ś	# LATIN CAPITAL LETTER S WITH ACUTE	[2000]
   #\u0160 ; 85A4  ; Š	# LATIN CAPITAL LETTER S WITH CARON	[2000]
   #\u015E ; 85A5  ; Ş	# LATIN CAPITAL LETTER S WITH CEDILLA 	[2000]
   #\u0164 ; 85A6  ; Ť	# LATIN CAPITAL LETTER T WITH CARON	[2000]
   #\u0179 ; 85A7  ; Ź	# LATIN CAPITAL LETTER Z WITH ACUTE	[2000]
   #\u017D ; 85A8  ; Ž	# LATIN CAPITAL LETTER Z WITH CARON	[2000]
   #\u017B ; 85A9  ; Ż	# LATIN CAPITAL LETTER Z WITH DOT ABOVE	[2000]
   #\u0105 ; 85AA  ; ą	# LATIN SMALL LETTER A WITH OGONEK	[2000]
   #\u0142 ; 85AC  ; ł	# LATIN SMALL LETTER L WITH STROKE	[2000]
   #\u013E ; 85AD  ; ľ	# LATIN SMALL LETTER L WITH CARON	[2000]
   #\u015B ; 85AE  ; ś	# LATIN SMALL LETTER S WITH ACUTE	[2000]
   #\u0161 ; 85B0  ; š	# LATIN SMALL LETTER S WITH CARON	[2000]
   #\u015F ; 85B1  ; ş	# LATIN SMALL LETTER S WITH CEDILLA 	[2000]
   #\u0165 ; 85B2  ; ť	# LATIN SMALL LETTER T WITH CARON	[2000]
   #\u017A ; 85B3  ; ź	# LATIN SMALL LETTER Z WITH ACUTE	[2000]
   #\u017E ; 85B5  ; ž	# LATIN SMALL LETTER Z WITH CARON	[2000]
   #\u017C ; 85B6  ; ż	# LATIN SMALL LETTER Z WITH DOT ABOVE	[2000]
   #\u0154 ; 85B7  ; Ŕ	# LATIN CAPITAL LETTER R WITH ACUTE	[2000]
   #\u0102 ; 85B8  ; Ă	# LATIN CAPITAL LETTER A WITH BREVE	[2000]
   #\u0139 ; 85B9  ; Ĺ	# LATIN CAPITAL LETTER L WITH ACUTE	[2000]
   #\u0106 ; 85BA  ; Ć	# LATIN CAPITAL LETTER C WITH ACUTE	[2000]
   #\u010C ; 85BB  ; Č	# LATIN CAPITAL LETTER C WITH CARON	[2000]
   #\u0118 ; 85BC  ; Ę	# LATIN CAPITAL LETTER E WITH OGONEK	[2000]
   #\u011A ; 85BD  ; Ě	# LATIN CAPITAL LETTER E WITH CARON	[2000]
   #\u010E ; 85BE  ; Ď	# LATIN CAPITAL LETTER D WITH CARON	[2000]
   #\u0143 ; 85BF  ; Ń	# LATIN CAPITAL LETTER N WITH ACUTE	[2000]
   #\u0147 ; 85C0  ; Ň	# LATIN CAPITAL LETTER N WITH CARON	[2000]
   #\u0150 ; 85C1  ; Ő	# LATIN CAPITAL LETTER O WITH DOUBLE ACUTE	[2000]
   #\u0158 ; 85C2  ; Ř	# LATIN CAPITAL LETTER R WITH CARON	[2000]
   #\u016E ; 85C3  ; Ů	# LATIN CAPITAL LETTER U WITH RING ABOVE	[2000]
   #\u0170 ; 85C4  ; Ű	# LATIN CAPITAL LETTER U WITH DOUBLE ACUTE	[2000]
   #\u0162 ; 85C5  ; Ţ	# LATIN CAPITAL LETTER T WITH CEDILLA 	[2000]
   #\u0155 ; 85C6  ; ŕ	# LATIN SMALL LETTER R WITH ACUTE	[2000]
   #\u0103 ; 85C7  ; ă	# LATIN SMALL LETTER A WITH BREVE	[2000]
   #\u013A ; 85C8  ; ĺ	# LATIN SMALL LETTER L WITH ACUTE	[2000]
   #\u0107 ; 85C9  ; ć	# LATIN SMALL LETTER C WITH ACUTE	[2000]
   #\u010D ; 85CA  ; č	# LATIN SMALL LETTER C WITH CARON	[2000]
   #\u0119 ; 85CB  ; ę	# LATIN SMALL LETTER E WITH OGONEK	[2000]
   #\u011B ; 85CC  ; ě	# LATIN SMALL LETTER E WITH CARON	[2000]
   #\u010F ; 85CD  ; ď	# LATIN SMALL LETTER D WITH CARON	[2000]
   #\u0111 ; 85CE  ; đ	# LATIN SMALL LETTER D WITH STROKE	[2000]
   #\u0144 ; 85CF  ; ń	# LATIN SMALL LETTER N WITH ACUTE	[2000]
   #\u0148 ; 85D0  ; ň	# LATIN SMALL LETTER N WITH CARON	[2000]
   #\u0151 ; 85D1  ; ő	# LATIN SMALL LETTER O WITH DOUBLE ACUTE	[2000]
   #\u0159 ; 85D2  ; ř	# LATIN SMALL LETTER R WITH CARON	[2000]
   #\u016F ; 85D3  ; ů	# LATIN SMALL LETTER U WITH RING ABOVE	[2000]
   #\u0171 ; 85D4  ; ű	# LATIN SMALL LETTER U WITH DOUBLE ACUTE	[2000]
   #\u0163 ; 85D5  ; ţ	# LATIN SMALL LETTER T WITH CEDILLA 	[2000]
   #\u0108 ; 85D7  ; Ĉ	# LATIN CAPITAL LETTER C WITH CIRCUMFLEX	[2000]
   #\u011C ; 85D8  ; Ĝ	# LATIN CAPITAL LETTER G WITH CIRCUMFLEX	[2000]
   #\u0124 ; 85D9  ; Ĥ	# LATIN CAPITAL LETTER H WITH CIRCUMFLEX	[2000]
   #\u0134 ; 85DA  ; Ĵ	# LATIN CAPITAL LETTER J WITH CIRCUMFLEX	[2000]
   #\u015C ; 85DB  ; Ŝ	# LATIN CAPITAL LETTER S WITH CIRCUMFLEX	[2000]
   #\u016C ; 85DC  ; Ŭ	# LATIN CAPITAL LETTER U WITH BREVE	[2000]
   #\u0109 ; 85DD  ; ĉ	# LATIN SMALL LETTER C WITH CIRCUMFLEX	[2000]
   #\u011D ; 85DE  ; ĝ	# LATIN SMALL LETTER G WITH CIRCUMFLEX	[2000]
   #\u0125 ; 85DF  ; ĥ	# LATIN SMALL LETTER H WITH CIRCUMFLEX	[2000]
   #\u0135 ; 85E0  ; ĵ	# LATIN SMALL LETTER J WITH CIRCUMFLEX	[2000]
   #\u015D ; 85E1  ; ŝ	# LATIN SMALL LETTER S WITH CIRCUMFLEX	[2000]
   #\u016D ; 85E2  ; ŭ	# LATIN SMALL LETTER U WITH BREVE	[2000]
   #\u0271 ; 85E3  ; ɱ	# LATIN SMALL LETTER M WITH HOOK	[2000]
   #\u028B ; 85E4  ; ʋ	# LATIN SMALL LETTER V WITH HOOK	[2000]
   #\u027E ; 85E5  ; ɾ	# LATIN SMALL LETTER R WITH FISHHOOK	[2000]
   #\u0283 ; 85E6  ; ʃ	# LATIN SMALL LETTER ESH	[2000]
   #\u0292 ; 85E7  ; ʒ	# LATIN SMALL LETTER EZH	[2000]
   #\u026C ; 85E8  ; ɬ	# LATIN SMALL LETTER L WITH BELT	[2000]
   #\u026E ; 85E9  ; ɮ	# LATIN SMALL LETTER LEZH	[2000]
   #\u0279 ; 85EA  ; ɹ	# LATIN SMALL LETTER TURNED R	[2000]
   #\u0288 ; 85EB  ; ʈ	# LATIN SMALL LETTER T WITH RETROFLEX HOOK	[2000]
   #\u0256 ; 85EC  ; ɖ	# LATIN SMALL LETTER D WITH TAIL	[2000]
   #\u0273 ; 85ED  ; ɳ	# LATIN SMALL LETTER N WITH RETROFLEX HOOK	[2000]
   #\u027D ; 85EE  ; ɽ	# LATIN SMALL LETTER R WITH TAIL	[2000]
   #\u0282 ; 85EF  ; ʂ	# LATIN SMALL LETTER S WITH HOOK	[2000]
   #\u0290 ; 85F0  ; ʐ	# LATIN SMALL LETTER Z WITH RETROFLEX HOOK	[2000]
   #\u027B ; 85F1  ; ɻ	# LATIN SMALL LETTER TURNED R WITH HOOK	[2000]
   #\u026D ; 85F2  ; ɭ	# LATIN SMALL LETTER L WITH RETROFLEX HOOK	[2000]
   #\u025F ; 85F3  ; ɟ	# LATIN SMALL LETTER DOTLESS J WITH STROKE	[2000]
   #\u0272 ; 85F4  ; ɲ	# LATIN SMALL LETTER N WITH LEFT HOOK	[2000]
   #\u029D ; 85F5  ; ʝ	# LATIN SMALL LETTER J WITH CROSSED-TAIL	[2000]
   #\u028E ; 85F6  ; ʎ	# LATIN SMALL LETTER TURNED Y	[2000]
   #\u0261 ; 85F7  ; ɡ	# LATIN SMALL LETTER SCRIPT G	[2000]
   #\u014B ; 85F8  ; ŋ	# LATIN SMALL LETTER ENG 	[2000]
   #\u0270 ; 85F9  ; ɰ	# LATIN SMALL LETTER TURNED M WITH LONG LEG	[2000]
   #\u0281 ; 85FA  ; ʁ	# LATIN LETTER SMALL CAPITAL INVERTED R	[2000]
   #\u0127 ; 85FB  ; ħ	# LATIN SMALL LETTER H WITH STROKE	[2000]
   #\u0295 ; 85FC  ; ʕ	# LATIN LETTER PHARYNGEAL VOICED FRICATIVE	[2000]
   #\u0294 ; 8640  ; ʔ	# LATIN LETTER GLOTTAL STOP	[2000]
   #\u0266 ; 8641  ; ɦ	# LATIN SMALL LETTER H WITH HOOK	[2000]
   #\u0298 ; 8642  ; ʘ	# LATIN LETTER BILABIAL CLICK	[2000]
   #\u01C2 ; 8643  ; ǂ	# LATIN LETTER ALVEOLAR CLICK	[2000]
   #\u0253 ; 8644  ; ɓ	# LATIN SMALL LETTER B WITH HOOK	[2000]
   #\u0257 ; 8645  ; ɗ	# LATIN SMALL LETTER D WITH HOOK	[2000]
   #\u0284 ; 8646  ; ʄ	# LATIN SMALL LETTER DOTLESS J WITH STROKE AND HOOK	[2000]
   #\u0260 ; 8647  ; ɠ	# LATIN SMALL LETTER G WITH HOOK	[2000]
   #\u0193 ; 8648  ; Ɠ	# LATIN CAPITAL LETTER G WITH HOOK	[2000]
   #\u0153 ; 8649  ; œ	# LATIN SMALL LIGATURE OE	[2000]
   #\u0152 ; 864A  ; Œ	# LATIN CAPITAL LIGATURE OE	[2000]
   #\u0268 ; 864B  ; ɨ	# LATIN SMALL LETTER I WITH STROKE	[2000]
   #\u0289 ; 864C  ; ʉ	# LATIN SMALL LETTER U BAR	[2000]
   #\u0258 ; 864D  ; ɘ	# LATIN SMALL LETTER REVERSED E	[2000]
   #\u0275 ; 864E  ; ɵ	# LATIN SMALL LETTER BARRED O	[2000]
   #\u0259 ; 864F  ; ə	# LATIN SMALL LETTER SCHWA	[2000]
   #\u025C ; 8650  ; ɜ	# LATIN SMALL LETTER REVERSED OPEN E	[2000]
   #\u025E ; 8651  ; ɞ	# LATIN SMALL LETTER CLOSED REVERSED OPEN E	[2000]
   #\u0250 ; 8652  ; ɐ	# LATIN SMALL LETTER TURNED A	[2000]
   #\u026F ; 8653  ; ɯ	# LATIN SMALL LETTER TURNED M	[2000]
   #\u028A ; 8654  ; ʊ	# LATIN SMALL LETTER UPSILON	[2000]
   #\u0264 ; 8655  ; ɤ	# LATIN SMALL LETTER RAMS HORN	[2000]
   #\u028C ; 8656  ; ʌ	# LATIN SMALL LETTER TURNED V	[2000]
   #\u0254 ; 8657  ; ɔ	# LATIN SMALL LETTER OPEN O	[2000]
   #\u0251 ; 8658  ; ɑ	# LATIN SMALL LETTER ALPHA	[2000]
   #\u0252 ; 8659  ; ɒ	# LATIN SMALL LETTER TURNED ALPHA	[2000]
   #\u028D ; 865A  ; ʍ	# LATIN SMALL LETTER TURNED W	[2000]
   #\u0265 ; 865B  ; ɥ	# LATIN SMALL LETTER TURNED H	[2000]
   #\u02A2 ; 865C  ; ʢ	# LATIN LETTER REVERSED GLOTTAL STOP WITH STROKE	[2000]
   #\u02A1 ; 865D  ; ʡ	# LATIN LETTER GLOTTAL STOP WITH STROKE	[2000]
   #\u0255 ; 865E  ; ɕ	# LATIN SMALL LETTER C WITH CURL	[2000]
   #\u0291 ; 865F  ; ʑ	# LATIN SMALL LETTER Z WITH CURL	[2000]
   #\u027A ; 8660  ; ɺ	# LATIN SMALL LETTER TURNED R WITH LONG LEG	[2000]
   #\u0267 ; 8661  ; ɧ	# LATIN SMALL LETTER HENG WITH HOOK	[2000]
   #\u025A ; 8662  ; ɚ	# LATIN SMALL LETTER SCHWA WITH HOOK	[2000]
   #\u00E6 #|+0300|# ; 8663  ; æ̀	# 	[2000]
   #\u01FD ; 8664  ; ǽ	# LATIN SMALL LETTER AE WITH ACUTE 	[2000]
   #\u1F70 ; 8665  ; ὰ	# GREEK SMALL LETTER ALPHA WITH VARIA	[2000]
   #\u1F71 ; 8666  ; ά	# GREEK SMALL LETTER ALPHA WITH OXIA	[2000]
   #\u0254 #|+0300|# ; 8667  ; ɔ̀	# 	[2000]
   #\u0254 #|+0301|# ; 8668  ; ɔ́	# 	[2000]
   #\u028C #|+0300|# ; 8669  ; ʌ̀	# 	[2000]
   #\u028C #|+0301|# ; 866A  ; ʌ́	# 	[2000]
   #\u0259 #|+0300|# ; 866B  ; ə̀	# 	[2000]
   #\u0259 #|+0301|# ; 866C  ; ə́	# 	[2000]
   #\u025A #|+0301|# ; 866D  ; ɚ̀	# 	[2000]
   #\u025A #|+0301|# ; 866E  ; ɚ́	# 	[2000]
   #\u1F72 ; 866F  ; ὲ	# GREEK SMALL LETTER EPSILON WITH VARIA	[2000]
   #\u1F73)) ; 8670  ; έ	# GREEK SMALL LETTER EPSILON WITH OXIA	[2000]

(patch/list diac 49 2)

(define (sjis k t)
  (define s1 (cond [(<=  1 k 62) (floor (/ (+ k 257) 2))]
                   [(<= 63 k 94) (floor (/ (+ k 385) 2))]))
  (define s2 (cond [(even? k)    (+ t 158)]
                   [(<=  1 t 63) (+ t 63)]
                   [(<= 64 t 94) (+ t 64)]))
  `(,s1 ,s2))

(define (sjis-tbl l k t)
  (define n (length l))
  (for/list ([i (range n)])
    (sjis (nk k t i) (nt t i))))

;(define diac-tbl (sjis-tbl diac 86 1))
;(displayln diac-tbl)

;; save
(define outname "font.bmp")
(send out save-file outname 'bmp)
(system (format "convert -monochrome ~a bmp3:~a" outname outname))
